<<<<<<< HEAD
var Miniflux={};var DEBUG=false;Miniflux.App=function(){return{Log:function(message){if(DEBUG){console.log(message)}},Run:function(){Miniflux.Event.ListenKeyboardEvents();Miniflux.Event.ListenMouseEvents();Miniflux.Event.ListenVisibilityEvents();Miniflux.Event.ListenTouchEvents();this.FrontendUpdateCheck()},FrontendUpdateCheck:function(){var request=new XMLHttpRequest;request.onload=function(){var response=JSON.parse(this.responseText);if(response.frontend_updatecheck_interval>0){Miniflux.App.Log("Frontend updatecheck interval in minutes: "+response.frontend_updatecheck_interval);Miniflux.Item.CheckForUpdates();setInterval(function(){Miniflux.Item.CheckForUpdates()},response.frontend_updatecheck_interval*60*1e3)}else{Miniflux.App.Log("Frontend updatecheck disabled")}};request.open("POST","?action=get-config",true);request.send(JSON.stringify(["frontend_updatecheck_interval"]))}}}();Miniflux.Feed=function(){var queue=[];var queue_length=5;var updateInterval=null;var feeds=[];return{Update:function(feed,callback){var itemsCounter=feed.querySelector("span.items-count");if(!itemsCounter)return;var feed_id=feed.getAttribute("data-feed-id");var heading=feed.querySelector("h2:first-of-type");heading.className="loading-icon";var request=new XMLHttpRequest;request.onload=function(){heading.className="";feed.removeAttribute("data-feed-error");var lastChecked=feed.querySelector(".feed-last-checked");if(lastChecked){lastChecked.innerHTML=lastChecked.getAttribute("data-after-update")}var response=JSON.parse(this.responseText);if(response.result){itemsCounter.innerHTML=response.items_count.items_unread+"/"+response.items_count.items_total}else{feed.setAttribute("data-feed-error","1");var errorMessageElement=feed.querySelector(".feed-parsing-error");if(errorMessageElement){errorMessageElement.innerHTML=response.feed.parsing_error_message}}if(callback){callback(response)}else{Miniflux.Item.CheckForUpdates()}};request.open("POST","?action=refresh-feed&feed_id="+feed_id,true);request.send()},UpdateAll:function(nb_concurrent_requests){feeds=Array.prototype.slice.call(document.querySelectorAll("article:not([data-feed-disabled])"));if(nb_concurrent_requests){queue_length=nb_concurrent_requests}updateInterval=setInterval(function(){while(feeds.length>0&&queue.length<queue_length){var feed=feeds.shift();queue.push(parseInt(feed.getAttribute("data-feed-id"),10));Miniflux.Feed.Update(feed,Miniflux.Feed.OnFeedUpdated)}},100)},OnFeedUpdated:function(response){var index=queue.indexOf(response.feed_id);if(index>=0)queue.splice(index,1);if(feeds.length===0&&queue.length===0){clearInterval(updateInterval);Miniflux.Item.CheckForUpdates()}}}}();Miniflux.Item=function(){var latest_feeds_items={};var unreadItems=false;var nbUnreadItems=function(){var navCounterElement=document.getElementById("nav-counter");if(navCounterElement){return parseInt(navCounterElement.textContent,10)||0}}();var nbPageItems=function(){var pageCounterElement=document.getElementById("page-counter");if(pageCounterElement){return parseInt(pageCounterElement.textContent,10)||0}}();function simulateMouseClick(element){var event=document.createEvent("MouseEvents");event.initEvent("mousedown",true,true);element.dispatchEvent(event);event=document.createEvent("MouseEvents");event.initEvent("mouseup",true,true);element.dispatchEvent(event);element.click()}function getItemID(item){return item.getAttribute("data-item-id")}function changeLabel(links){if(links.length===0){return}for(var i=0;i<links.length;i++){var link=links[i];if(link.hasAttribute("data-reverse-label")){var content=link.innerHTML;link.innerHTML=link.getAttribute("data-reverse-label");link.setAttribute("data-reverse-label",content)}if(link.hasAttribute("data-reverse-title")){var title=link.getAttribute("title");link.setAttribute("title",link.getAttribute("data-reverse-title"));link.setAttribute("data-reverse-title",title)}}}function changeAction(links,action){if(links.length===0){return}for(var i=0;i<links.length;i++){links[i].setAttribute("data-action",action)}}function changeBookmarkLabel(item){var links=item.querySelectorAll(".bookmark-icon, a.bookmark");changeLabel(links)}function changeStatusLabel(item){var links=item.querySelectorAll(".read-icon, a.mark");changeLabel(links)}function showItemAsRead(item){if(item.getAttribute("data-item-status")==="read"){return}nbUnreadItems--;if(item.getAttribute("data-hide")){hideItem(item);return}item.setAttribute("data-item-status","read");changeStatusLabel(item);var links=item.querySelectorAll(".read-icon, a.mark");changeAction(links,"mark-unread")}function showItemAsUnread(item){if(item.getAttribute("data-item-status")==="unread"){return}nbUnreadItems++;if(item.getAttribute("data-hide")){hideItem(item);return}item.setAttribute("data-item-status","unread");changeStatusLabel(item);var links=item.querySelectorAll(".read-icon, a.mark");changeAction(links,"mark-read")}function hideItem(item){if(Miniflux.Event.lastEventType!=="mouse"){var items=document.getElementsByTagName("article");if(items[items.length-1].id==="current-item"){Miniflux.Nav.SelectPreviousItem()}else{Miniflux.Nav.SelectNextItem()}}item.parentNode.removeChild(item);nbPageItems--}function updateCounters(){var pageHeading=null;if(window.location.href.indexOf("nothing_to_read=1")>-1&&nbUnreadItems>0){window.location.href="?action=unread"}else if(nbPageItems===0){window.location.reload()}var pageCounterElement=document.getElementById("page-counter");if(pageCounterElement)pageCounterElement.textContent=nbPageItems||"";var navCounterElement=document.getElementById("nav-counter");navCounterElement.textContent=nbUnreadItems||"";var pageHeadingElement=document.querySelector("div.page-header h2:first-of-type");if(pageHeadingElement){pageHeading=pageHeadingElement.firstChild.nodeValue}else{var itemHeading=document.querySelector("article.item h1:first-of-type");if(itemHeading){document.title=itemHeading.textContent;return}}var sectionElement=document.querySelector("section.page");switch(sectionElement.getAttribute("data-item-page")){case"unread":document.title="Miniflux ("+nbUnreadItems+")";break;case"feed-items":document.title="("+nbPageItems+") "+pageHeading;break;default:if(pageCounterElement){document.title=pageHeading+" ("+nbPageItems+")"}else{document.title=pageHeading}break}}function markAsRead(item){var item_id=getItemID(item);var request=new XMLHttpRequest;request.onload=function(){if(Miniflux.Nav.IsListing()){showItemAsRead(item);updateCounters()}};request.open("POST","?action=mark-item-read&id="+item_id,true);request.send()}function markAsUnread(item){var item_id=getItemID(item);var request=new XMLHttpRequest;request.onload=function(){if(Miniflux.Nav.IsListing()){showItemAsUnread(item);updateCounters()}};request.open("POST","?action=mark-item-unread&id="+item_id,true);request.send()}function markAsRemoved(item){var item_id=getItemID(item);var request=new XMLHttpRequest;request.onload=function(){if(Miniflux.Nav.IsListing()){hideItem(item);if(item.getAttribute("data-item-status")==="unread")nbUnreadItems--;updateCounters()}};request.open("POST","?action=mark-item-removed&id="+item_id,true);request.send()}return{MarkAsRead:markAsRead,MarkAsUnread:markAsUnread,MarkAsRemoved:markAsRemoved,SwitchBookmark:function(item){var item_id=getItemID(item);var value=item.getAttribute("data-item-bookmark")==="1"?"0":"1";var request=new XMLHttpRequest;request.onload=function(){var sectionElement=document.querySelector("section.page");if(Miniflux.Nav.IsListing()&&sectionElement.getAttribute("data-item-page")==="bookmarks"){hideItem(item);updateCounters()}else{item.setAttribute("data-item-bookmark",value);changeBookmarkLabel(item)}};request.open("POST","?action=bookmark&id="+item_id+"&value="+value,true);request.send()},SwitchStatus:function(item){var status=item.getAttribute("data-item-status");if(status==="read"){markAsUnread(item)}else if(status==="unread"){markAsRead(item)}},Show:function(item){var link=item.querySelector("a.show");if(link)simulateMouseClick(link)},OpenOriginal:function(item){var link=item.querySelector("a.original");if(link){simulateMouseClick(link)}},DownloadContent:function(item){var container=document.getElementById("download-item");if(!container)return;container.innerHTML=" "+container.getAttribute("data-before-message");container.className="loading-icon";var request=new XMLHttpRequest;request.onload=function(){var response=JSON.parse(request.responseText);container.className="";if(response.result){var content=document.getElementById("item-content");if(content)content.innerHTML=response.content;container.innerHTML=container.getAttribute("data-after-message")}else{container.innerHTML=container.getAttribute("data-failure-message")}};var item_id=getItemID(item);request.open("POST","?action=download-item&id="+item_id,true);request.send()},MarkFeedAsRead:function(feed_id){var request=new XMLHttpRequest;request.onload=function(){var articles=document.getElementsByTagName("article");for(var i=0,ilen=articles.length;i<ilen;i++){showItemAsRead(articles[i])}nbUnreadItems=this.responseText;updateCounters()};request.open("POST","?action=mark-feed-as-read&feed_id="+feed_id,true);request.send()},ToggleRTLMode:function(){var tags=["#current-item h1","#item-content","#listing #current-item h2","#listing #current-item .preview","#listing #current-item .preview-full-content"];for(var i=0;i<tags.length;i++){var tag=document.querySelector(tags[i]);if(tag){tag.dir=tag.dir===""?"rtl":""}}},hasNewUnread:function(){return unreadItems},CheckForUpdates:function(){if(document.hidden&&unreadItems){Miniflux.App.Log("We already have updates, no need to check again");return}var request=new XMLHttpRequest;request.onload=function(){var first_run=latest_feeds_items.length===0;var current_unread=false;var response=JSON.parse(this.responseText);var last_items_timestamps=response.last_items_timestamps;for(var i=0;i<last_items_timestamps.length;i++){var current_feed=last_items_timestamps[i];var feed_id=current_feed.feed_id;if(!latest_feeds_items.hasOwnProperty(feed_id)||current_feed.updated>latest_feeds_items[feed_id]){latest_feeds_items[feed_id]=current_feed.updated;current_unread=true}}Miniflux.App.Log("first_run: "+first_run+", current_unread: "+current_unread+", response.nbUnread: "+response.nbUnread+", nbUnreadItems: "+nbUnreadItems);if(!document.hidden&&(response.nb_unread_items!==nbUnreadItems||unreadItems)){Miniflux.App.Log("Counter changed! Updating unread counter.");unreadItems=false;nbUnreadItems=response.nb_unread_items;updateCounters()}else if(document.hidden&&!first_run&&current_unread){Miniflux.App.Log("New Unread! Updating pagetitle.");unreadItems=true;document.title="↻ "+document.title}else{Miniflux.App.Log("No update.")}Miniflux.App.Log("unreadItems: "+unreadItems)};request.open("GET","?action=latest-feeds-items",true);request.send()}}}();Miniflux.Event=function(){var queue=[];function isEventIgnored(e){if(e.keyCode!==63&&e.which!==63&&(e.ctrlKey||e.altKey||e.metaKey)){return true}var target=e.target||e.srcElement;return target.tagName==="INPUT"||target.tagName==="TEXTAREA"}return{lastEventType:"",ListenMouseEvents:function(){document.onclick=function(e){if(e.target.hasAttribute("data-action")&&e.target.className!=="original"){e.preventDefault()}};document.onmouseup=function(e){if(e.button===2){return}if(e.target.nodeName==="INPUT"&&e.target.className==="auto-select"){e.target.select();return}var action=e.target.getAttribute("data-action");if(action){Miniflux.Event.lastEventType="mouse";var currentItem=function(){var element=e.target;while(element&&element.parentNode){element=element.parentNode;if(element.tagName&&element.tagName.toLowerCase()==="article"){return element}}}();switch(action){case"refresh-all":Miniflux.Feed.UpdateAll(e.target.getAttribute("data-concurrent-requests"));break;case"refresh-feed":if(currentItem){Miniflux.Feed.Update(currentItem)}break;case"mark-read":if(currentItem){Miniflux.Item.MarkAsRead(currentItem)}break;case"mark-unread":if(currentItem){Miniflux.Item.MarkAsUnread(currentItem)}break;case"mark-removed":if(currentItem){Miniflux.Item.MarkAsRemoved(currentItem)}break;case"bookmark":if(currentItem){Miniflux.Item.SwitchBookmark(currentItem)}break;case"download-item":if(currentItem){Miniflux.Item.DownloadContent(currentItem)}break;case"mark-feed-read":var feed_id=document.getElementById("listing").getAttribute("data-feed-id");Miniflux.Item.MarkFeedAsRead(feed_id);break;case"close-help":Miniflux.Nav.CloseHelp();break;case"show-search":Miniflux.Nav.ShowSearch();break;case"toggle-menu-more":Miniflux.Nav.ToggleMenuMore();break}}}},ListenKeyboardEvents:function(){document.onkeypress=function(e){if(isEventIgnored(e)){return}Miniflux.Event.lastEventType="keyboard";queue.push(e.key||e.which);if(queue[0]==="g"||queue[0]===103){switch(queue[1]){case undefined:break;case"u":case 117:window.location.href="?action=unread";queue=[];break;case"b":case 98:window.location.href="?action=bookmarks";queue=[];break;case"h":case 104:window.location.href="?action=history";queue=[];break;case"s":case 115:window.location.href="?action=feeds";queue=[];break;case"p":case 112:window.location.href="?action=config";queue=[];break;default:queue=[];break}}else{queue=[];var currentItem=function(){return document.getElementById("current-item")}();switch(e.key||e.which){case"A":case 65:if(e.shiftKey){window.location.href='?action=mark-all-read'}break;case"d":case 100:if(currentItem){Miniflux.Item.DownloadContent(currentItem)}break;case"p":case 112:case"k":case 107:Miniflux.Nav.SelectPreviousItem();break;case"n":case 110:case"j":case 106:Miniflux.Nav.SelectNextItem();break;case"v":case 118:if(currentItem){Miniflux.Item.OpenOriginal(currentItem);Miniflux.Nav.SelectNextItem()}break;case"o":case 111:if(currentItem){Miniflux.Item.Show(currentItem)}break;case"m":case 109:if(currentItem){Miniflux.Item.SwitchStatus(currentItem)}break;case"f":case 102:if(currentItem){Miniflux.Item.SwitchBookmark(currentItem)}break;case"h":case 104:Miniflux.Nav.OpenPreviousPage();break;case"l":case 108:Miniflux.Nav.OpenNextPage();break;case"r":case 114:Miniflux.Feed.UpdateAll();break;case"?":case 63:Miniflux.Nav.ShowHelp();break;case"Q":case 81:case"q":case 113:Miniflux.Nav.CloseHelp();break;case"z":case 122:Miniflux.Item.ToggleRTLMode();break}}};document.onkeydown=function(e){if(isEventIgnored(e)){return}Miniflux.Event.lastEventType="keyboard";switch(e.key||e.which){case"ArrowLeft":case"Left":case 37:Miniflux.Nav.SelectPreviousItem();break;case"ArrowRight":case"Right":case 39:Miniflux.Nav.SelectNextItem();break;case"/":case 191:e.preventDefault();e.stopPropagation();Miniflux.Nav.ShowSearch();break}}},ListenVisibilityEvents:function(){document.addEventListener("visibilitychange",function(){Miniflux.App.Log("document.visibilityState: "+document.visibilityState);if(!document.hidden&&Miniflux.Item.hasNewUnread()){Miniflux.App.Log("Need to update the unread counter with fresh values from the database");Miniflux.Item.CheckForUpdates()}})},ListenTouchEvents:function(){var touches=null;var resetTouch=function(){if(touches&&touches.element){touches.element.style.opacity=1;touches.element.style.transform=""}touches={touchstart:{x:-1,y:-1},touchmove:{x:-1,y:-1},touchend:false,direction:"undetermined",swipestarted:false,element:null}};var horizontalSwipe=function(){if(touches.touchstart.x>-1&&touches.touchmove.x>-1&&(Math.abs(touches.touchmove.x-touches.touchstart.x)>30||touches.swipestarted)&&Math.abs(touches.touchmove.y-touches.touchstart.y)<75){touches.swipestarted=true;return touches.touchmove.x-touches.touchstart.x}return 0};var closest=function(el,fn){return el&&(fn(el)?el:closest(el.parentNode,fn))};var getTouchElement=function(){return touches.element?touches.element:closest(document.elementFromPoint(touches.touchstart.x,touches.touchstart.y),function(el){return el.tagName==="ARTICLE"})};var drawElement=function(){if(touches&&(touches.touchend===true||touches.touchstart.x==-1)){return}if(touches.element===null){touches.element=getTouchElement()}var swipedistance=horizontalSwipe();if(swipedistance!==0){var element=getTouchElement();if(!element){resetTouch();return}var distance=Math.abs(swipedistance);touches.element.style.opacity=1-(distance>75?.9:distance/75*.9);var tx=swipedistance>75?75:swipedistance<-75?-75:swipedistance;touches.element.style.transform="translateX("+tx+"px)";touches.element=element}window.requestAnimationFrame(drawElement)};var touchHandler=function(e){if(typeof e.touches!="undefined"&&e.touches.length<=1){var touch=e.touches[0];var swipedistance=null;var element=null;switch(e.type){case"touchstart":resetTouch();touches[e.type].x=touch.clientX;touches[e.type].y=touch.clientY;drawElement();break;case"touchmove":touches[e.type].x=touch.clientX;touches[e.type].y=touch.clientY;break;case"touchend":touches[e.type]=true;element=getTouchElement();swipedistance=horizontalSwipe();if(swipedistance>75||swipedistance<-75){if(element){Miniflux.Item.MarkAsRead(element)}if(!element.getAttribute("data-hide")){resetTouch()}}else{resetTouch()}break;case"touchcancel":resetTouch();break;default:break}}else{resetTouch()}};resetTouch();document.addEventListener("touchstart",touchHandler,false);document.addEventListener("touchmove",touchHandler,false);document.addEventListener("touchend",touchHandler,false);document.addEventListener("touchcancel",touchHandler,false)}}}();Miniflux.Nav=function(){function scrollPageTo(item){var clientHeight=pageYOffset+document.documentElement.clientHeight;var itemPosition=item.offsetTop+item.offsetHeight;if(clientHeight-itemPosition<0||clientHeight-item.offsetTop>document.documentElement.clientHeight){window.scrollTo(0,item.offsetTop-10)}}function findNextItem(){var items=document.getElementsByTagName("article");if(!document.getElementById("current-item")){items[0].id="current-item";scrollPageTo(items[0])}else{for(var i=0,ilen=items.length;i<ilen;i++){if(items[i].id==="current-item"){if(i+1<ilen){items[i].id="item-"+items[i].getAttribute("data-item-id");items[i+1].id="current-item";scrollPageTo(items[i+1])}break}}}}function findPreviousItem(){var items=document.getElementsByTagName("article");if(!document.getElementById("current-item")){items[items.length-1].id="current-item";scrollPageTo(items[items.length-1])}else{for(var i=items.length-1;i>=0;i--){if(items[i].id==="current-item"){if(i-1>=0){items[i].id="item-"+items[i].getAttribute("data-item-id");items[i-1].id="current-item";scrollPageTo(items[i-1])}break}}}}function isListing(){return!!document.getElementById("listing")}return{OpenNextPage:function(){var link=document.getElementById("next-page");if(link)link.click()},OpenPreviousPage:function(){var link=document.getElementById("previous-page");if(link)link.click()},SelectNextItem:function(){var link=document.getElementById("next-item");if(link){link.click()}else if(isListing()){findNextItem()}},SelectPreviousItem:function(){var link=document.getElementById("previous-item");if(link){link.click()}else if(isListing()){findPreviousItem()}},ShowHelp:function(){var help_layer=document.getElementById("help-layer");help_layer.removeAttribute("class")},CloseHelp:function(){var help_layer=document.getElementById("help-layer");help_layer.setAttribute("class","hide")},ShowSearch:function(){document.getElementById("search-opener").setAttribute("class","hide");document.getElementById("search-form").removeAttribute("class");document.getElementById("form-text").focus()},ToggleMenuMore:function(){var menu=document.getElementById("menu-more");if(menu.hasAttribute("class")){menu.removeAttribute("class")}else{menu.setAttribute("class","hide")}},IsListing:isListing}}();
=======
var Miniflux={},DEBUG=!1;Miniflux.App=function(){return{Log:function(a){DEBUG&&console.log(a)},Run:function(){Miniflux.Event.ListenKeyboardEvents(),Miniflux.Event.ListenMouseEvents(),Miniflux.Event.ListenVisibilityEvents(),Miniflux.Event.ListenTouchEvents(),this.FrontendUpdateCheck(),document.addEventListener("DOMContentLoaded",Miniflux.Item.selectFirstItem(),!1)},FrontendUpdateCheck:function(){var a=new XMLHttpRequest;a.onload=function(){var a=JSON.parse(this.responseText);a.frontend_updatecheck_interval>0?(Miniflux.App.Log("Frontend updatecheck interval in minutes: "+a.frontend_updatecheck_interval),Miniflux.Item.CheckForUpdates(),setInterval(function(){Miniflux.Item.CheckForUpdates()},60*a.frontend_updatecheck_interval*1e3)):Miniflux.App.Log("Frontend updatecheck disabled")},a.open("POST","?action=get-config",!0),a.send(JSON.stringify(["frontend_updatecheck_interval"]))}}}(),Miniflux.Event=function(){function b(a){if(63!==a.keyCode&&63!==a.which&&(a.ctrlKey||a.shiftKey||a.altKey||a.metaKey))return!0;var b=a.target||a.srcElement;return"INPUT"===b.tagName||"TEXTAREA"===b.tagName}var a=[];return{lastEventType:"",ListenMouseEvents:function(){document.onclick=function(a){a.target.hasAttribute("data-action")&&"original"!==a.target.className&&a.preventDefault()},document.onmouseup=function(a){if(2!==a.button){if("INPUT"===a.target.nodeName&&"auto-select"===a.target.className)return void a.target.select();var b=a.target.getAttribute("data-action");if(b){Miniflux.Event.lastEventType="mouse";var c=function(){for(var b=a.target;b&&b.parentNode;)if(b=b.parentNode,b.tagName&&"article"===b.tagName.toLowerCase())return b}();switch(b){case"refresh-all":Miniflux.Feed.UpdateAll(a.target.getAttribute("data-concurrent-requests"));break;case"refresh-feed":c&&Miniflux.Feed.Update(c);break;case"mark-read":c&&Miniflux.Item.MarkAsRead(c);break;case"mark-unread":c&&Miniflux.Item.MarkAsUnread(c);break;case"mark-removed":c&&Miniflux.Item.MarkAsRemoved(c);break;case"bookmark":c&&(Miniflux.Item.SwitchBookmark(c),Miniflux.Item.MarkAsRead(c));break;case"download-item":c&&Miniflux.Item.DownloadContent(c);break;case"mark-feed-read":var d=document.getElementById("listing").getAttribute("data-feed-id");Miniflux.Item.MarkFeedAsRead(d);break;case"close-help":Miniflux.Nav.CloseHelp();break;case"show-search":Miniflux.Nav.ShowSearch();break;case"toggle-menu-more":Miniflux.Nav.ToggleMenuMore()}}}}},ListenKeyboardEvents:function(){document.onkeypress=function(c){if(!b(c))if(Miniflux.Event.lastEventType="keyboard",a.push(c.key||c.which),"g"===a[0]||103===a[0])switch(a[1]){case void 0:break;case"u":case 117:window.location.href="?action=unread",a=[];break;case"b":case 98:window.location.href="?action=bookmarks",a=[];break;case"h":case 104:window.location.href="?action=history",a=[];break;case"s":case 115:window.location.href="?action=feeds",a=[];break;case"p":case 112:window.location.href="?action=config",a=[];break;default:a=[]}else{a=[];var d=function(){return document.getElementById("current-item")}();switch(c.key||c.which){case"d":case 100:d&&Miniflux.Item.DownloadContent(d);break;case"p":case 112:case"k":case 107:Miniflux.Nav.SelectPreviousItem();break;case"n":case 110:case"j":case 106:Miniflux.Nav.SelectNextItem();break;case"v":case 118:d&&Miniflux.Item.OpenOriginal(d);break;case"o":case 111:d&&Miniflux.Item.Show(d);break;case"m":case 109:d&&Miniflux.Item.SwitchStatus(d);break;case"f":case 102:d&&(Miniflux.Item.SwitchBookmark(d),Miniflux.Item.MarkAsRead(d));break;case"h":case 104:Miniflux.Nav.OpenPreviousPage();break;case"l":case 108:Miniflux.Nav.OpenNextPage();break;case"r":case 114:Miniflux.Feed.UpdateAll();break;case"?":case 63:Miniflux.Nav.ShowHelp();break;case"Q":case 81:case"q":case 113:Miniflux.Nav.CloseHelp();break;case"z":case 122:Miniflux.Item.ToggleRTLMode()}}},document.onkeydown=function(a){if(!b(a))switch(Miniflux.Event.lastEventType="keyboard",a.key||a.which){case"ArrowLeft":case"Left":case 37:Miniflux.Nav.SelectPreviousItem();break;case"ArrowRight":case"Right":case 39:Miniflux.Nav.SelectNextItem();break;case"/":case 191:a.preventDefault(),a.stopPropagation(),Miniflux.Nav.ShowSearch()}}},ListenVisibilityEvents:function(){document.addEventListener("visibilitychange",function(){Miniflux.App.Log("document.visibilityState: "+document.visibilityState),!document.hidden&&Miniflux.Item.hasNewUnread()&&(Miniflux.App.Log("Need to update the unread counter with fresh values from the database"),Miniflux.Item.CheckForUpdates())})},ListenTouchEvents:function(){var a=null,b=function(){a&&a.element&&(a.element.style.opacity=1,a.element.style.transform=""),a={touchstart:{x:-1,y:-1},touchmove:{x:-1,y:-1},touchend:!1,direction:"undetermined",swipestarted:!1,element:null}},c=function(){return a.touchstart.x>-1&&a.touchmove.x>-1&&(Math.abs(a.touchmove.x-a.touchstart.x)>30||a.swipestarted)&&Math.abs(a.touchmove.y-a.touchstart.y)<75?(a.swipestarted=!0,a.touchmove.x-a.touchstart.x):0},d=function(a,b){return a&&(b(a)?a:d(a.parentNode,b))},e=function(){return a.element?a.element:d(document.elementFromPoint(a.touchstart.x,a.touchstart.y),function(a){return"ARTICLE"===a.tagName})},f=function(){if(!a||a.touchend!==!0&&a.touchstart.x!=-1){null===a.element&&(a.element=e());var d=c();if(0!==d){var g=e();if(!g)return void b();var h=Math.abs(d);a.element.style.opacity=1-(h>75?.9:h/75*.9);var i=d>75?75:d<-75?-75:d;a.element.style.transform="translateX("+i+"px)",a.element=g}window.requestAnimationFrame(f)}},g=function(d){if("undefined"!=typeof d.touches&&d.touches.length<=1){var g=d.touches[0],h=null,i=null;switch(d.type){case"touchstart":b(),a[d.type].x=g.clientX,a[d.type].y=g.clientY,f();break;case"touchmove":a[d.type].x=g.clientX,a[d.type].y=g.clientY;break;case"touchend":a[d.type]=!0,i=e(),h=c(),h>75||h<-75?(i&&Miniflux.Item.MarkAsRead(i),i.getAttribute("data-hide")||b()):b();break;case"touchcancel":b()}}else b()};b(),document.addEventListener("touchstart",g,!1),document.addEventListener("touchmove",g,!1),document.addEventListener("touchend",g,!1),document.addEventListener("touchcancel",g,!1)}}}(),Miniflux.Feed=function(){var a=[],b=5,c=null,d=[];return{Update:function(a,b){var c=a.querySelector("span.items-count");if(c){var d=a.getAttribute("data-feed-id"),e=a.querySelector("h2:first-of-type");e.className="loading-icon";var f=new XMLHttpRequest;f.onload=function(){e.className="",a.removeAttribute("data-feed-error");var d=a.querySelector(".feed-last-checked");d&&(d.innerHTML=d.getAttribute("data-after-update"));var f=JSON.parse(this.responseText);if(f.result)c.innerHTML=f.items_count.items_unread+"/"+f.items_count.items_total;else{a.setAttribute("data-feed-error","1");var g=a.querySelector(".feed-parsing-error");g&&(g.innerHTML=f.feed.parsing_error_message)}b?b(f):Miniflux.Item.CheckForUpdates()},f.open("POST","?action=refresh-feed&feed_id="+d,!0),f.send()}},UpdateAll:function(e){d=Array.prototype.slice.call(document.querySelectorAll("article:not([data-feed-disabled])")),e&&(b=e),c=setInterval(function(){for(;d.length>0&&a.length<b;){var c=d.shift();a.push(parseInt(c.getAttribute("data-feed-id"),10)),Miniflux.Feed.Update(c,Miniflux.Feed.OnFeedUpdated)}},100)},OnFeedUpdated:function(b){var e=a.indexOf(b.feed_id);e>=0&&a.splice(e,1),0===d.length&&0===a.length&&(clearInterval(c),Miniflux.Item.CheckForUpdates())}}}(),Miniflux.Item=function(){function e(a){var b=document.createEvent("MouseEvents");b.initEvent("mousedown",!0,!0),a.dispatchEvent(b),b=document.createEvent("MouseEvents"),b.initEvent("mouseup",!0,!0),a.dispatchEvent(b),a.click()}function f(a){return a.getAttribute("data-item-id")}function g(a){if(0!==a.length)for(var b=0;b<a.length;b++){var c=a[b];if(c.hasAttribute("data-reverse-label")){var d=c.innerHTML;c.innerHTML=c.getAttribute("data-reverse-label"),c.setAttribute("data-reverse-label",d)}if(c.hasAttribute("data-reverse-title")){var e=c.getAttribute("title");c.setAttribute("title",c.getAttribute("data-reverse-title")),c.setAttribute("data-reverse-title",e)}}}function h(a,b){if(0!==a.length)for(var c=0;c<a.length;c++)a[c].setAttribute("data-action",b)}function i(a){var b=a.querySelectorAll(".bookmark-icon, a.bookmark");g(b)}function j(a){var b=a.querySelectorAll(".read-icon, a.mark");g(b)}function k(a){if("read"!==a.getAttribute("data-item-status")){if(c--,a.getAttribute("data-hide"))return void m(a);a.setAttribute("data-item-status","read"),j(a);var b=a.querySelectorAll(".read-icon, a.mark");h(b,"mark-unread")}}function l(a){if("unread"!==a.getAttribute("data-item-status")){if(c++,a.getAttribute("data-hide"))return void m(a);a.setAttribute("data-item-status","unread"),j(a);var b=a.querySelectorAll(".read-icon, a.mark");h(b,"mark-read")}}function m(a){if("mouse"!==Miniflux.Event.lastEventType){var b=document.getElementsByTagName("article");"current-item"===b[b.length-1].id?Miniflux.Nav.SelectPreviousItem():Miniflux.Nav.SelectNextItem()}a.parentNode.removeChild(a),d--}function n(){var a=null;window.location.href.indexOf("nothing_to_read=1")>-1&&c>0?window.location.href="?action=unread":0===d&&window.location.reload();var b=document.getElementById("page-counter");b&&(b.textContent=d||"");var e=document.getElementById("nav-counter");e.textContent=c||"";var f=document.querySelector("div.page-header h2:first-of-type");if(f)a=f.firstChild.nodeValue;else{var g=document.querySelector("article.item h1:first-of-type");if(g)return void(document.title=g.textContent)}var h=document.querySelector("section.page");switch(h.getAttribute("data-item-page")){case"unread":document.title="Miniflux ("+c+")";break;case"feed-items":document.title="("+d+") "+a;break;default:b?document.title=a+" ("+d+")":document.title=a}}function o(a){var b=f(a),c=new XMLHttpRequest;c.onload=function(){Miniflux.Nav.IsListing()&&(k(a),n())},c.open("POST","?action=mark-item-read&id="+b,!0),c.send()}function p(a){var b=f(a),c=new XMLHttpRequest;c.onload=function(){Miniflux.Nav.IsListing()&&(l(a),n())},c.open("POST","?action=mark-item-unread&id="+b,!0),c.send()}function q(a){var b=f(a),d=new XMLHttpRequest;d.onload=function(){Miniflux.Nav.IsListing()&&(m(a),"unread"===a.getAttribute("data-item-status")&&c--,n())},d.open("POST","?action=mark-item-removed&id="+b,!0),d.send()}var a={},b=!1,c=function(){var a=document.getElementById("nav-counter");if(a)return parseInt(a.textContent,10)||0}(),d=function(){var a=document.getElementById("page-counter");if(a)return parseInt(a.textContent,10)||0}();return{MarkAsRead:o,MarkAsUnread:p,MarkAsRemoved:q,SwitchBookmark:function(a){var b=f(a),c="1"===a.getAttribute("data-item-bookmark")?"0":"1",d=new XMLHttpRequest;d.onload=function(){var b=document.querySelector("section.page");Miniflux.Nav.IsListing()&&"bookmarks"===b.getAttribute("data-item-page")?(m(a),n()):(a.setAttribute("data-item-bookmark",c),i(a))},d.open("POST","?action=bookmark&id="+b+"&value="+c,!0),d.send()},selectFirstItem:function(){d>0&&Miniflux.Nav.SelectNextItem()},SwitchStatus:function(a){var b=a.getAttribute("data-item-status");"read"===b?p(a):"unread"===b&&o(a)},Show:function(a){var b=a.querySelector("a.show");b&&e(b)},OpenOriginal:function(a){var b=a.querySelector("a.original");b&&e(b)},DownloadContent:function(a){var b=document.getElementById("download-item");if(b){b.innerHTML=" "+b.getAttribute("data-before-message"),b.className="loading-icon";var c=new XMLHttpRequest;c.onload=function(){var a=JSON.parse(c.responseText);if(b.className="",a.result){var d=document.getElementById("item-content");d&&(d.innerHTML=a.content),b.innerHTML=b.getAttribute("data-after-message")}else b.innerHTML=b.getAttribute("data-failure-message")};var d=f(a);c.open("POST","?action=download-item&id="+d,!0),c.send()}},MarkFeedAsRead:function(a){var b=new XMLHttpRequest;b.onload=function(){for(var a=document.getElementsByTagName("article"),b=0,d=a.length;b<d;b++)k(a[b]);c=this.responseText,n()},b.open("POST","?action=mark-feed-as-read&feed_id="+a,!0),b.send()},ToggleRTLMode:function(){for(var a=["#current-item h1","#item-content","#listing #current-item h2","#listing #current-item .preview","#listing #current-item .preview-full-content"],b=0;b<a.length;b++){var c=document.querySelector(a[b]);c&&(c.dir=""===c.dir?"rtl":"")}},hasNewUnread:function(){return b},CheckForUpdates:function(){if(document.hidden&&b)return void Miniflux.App.Log("We already have updates, no need to check again");var d=new XMLHttpRequest;d.onload=function(){for(var d=0===a.length,e=!1,f=JSON.parse(this.responseText),g=f.last_items_timestamps,h=0;h<g.length;h++){var i=g[h],j=i.feed_id;(!a.hasOwnProperty(j)||i.updated>a[j])&&(a[j]=i.updated,e=!0)}Miniflux.App.Log("first_run: "+d+", current_unread: "+e+", response.nbUnread: "+f.nbUnread+", nbUnreadItems: "+c),document.hidden||f.nb_unread_items===c&&!b?document.hidden&&!d&&e?(Miniflux.App.Log("New Unread! Updating pagetitle."),b=!0,document.title="↻ "+document.title):Miniflux.App.Log("No update."):(Miniflux.App.Log("Counter changed! Updating unread counter."),b=!1,c=f.nb_unread_items,n()),Miniflux.App.Log("unreadItems: "+b)},d.open("GET","?action=latest-feeds-items",!0),d.send()}}}(),Miniflux.Nav=function(){function a(a){var b=pageYOffset+document.documentElement.clientHeight,c=a.offsetTop+a.offsetHeight;(b-c<0||b-a.offsetTop>document.documentElement.clientHeight)&&window.scrollTo(0,a.offsetTop-10)}function b(){var b=document.getElementsByTagName("article");if(document.getElementById("current-item")){for(var c=0,d=b.length;c<d;c++)if("current-item"===b[c].id){c+1<d&&(b[c].id="item-"+b[c].getAttribute("data-item-id"),b[c+1].id="current-item",a(b[c+1]));break}}else b[0].id="current-item",a(b[0])}function c(){var b=document.getElementsByTagName("article");if(document.getElementById("current-item")){for(var c=b.length-1;c>=0;c--)if("current-item"===b[c].id){c-1>=0&&(b[c].id="item-"+b[c].getAttribute("data-item-id"),b[c-1].id="current-item",a(b[c-1]));break}}else b[b.length-1].id="current-item",a(b[b.length-1])}function d(){return!!document.getElementById("listing")}return{OpenNextPage:function(){var a=document.getElementById("next-page");a&&a.click()},OpenPreviousPage:function(){var a=document.getElementById("previous-page");a&&a.click()},SelectNextItem:function(){var a=document.getElementById("next-item");a?a.click():d()&&b()},SelectPreviousItem:function(){var a=document.getElementById("previous-item");a?a.click():d()&&c()},ShowHelp:function(){var a=document.getElementById("help-layer");a.removeAttribute("class")},CloseHelp:function(){var a=document.getElementById("help-layer");a.setAttribute("class","hide")},ShowSearch:function(){document.getElementById("search-opener").setAttribute("class","hide"),document.getElementById("search-form").removeAttribute("class"),document.getElementById("form-text").focus()},ToggleMenuMore:function(){var a=document.getElementById("menu-more");a.hasAttribute("class")?a.removeAttribute("class"):a.setAttribute("class","hide")},IsListing:d}}();
>>>>>>> erunaheru
Miniflux.App.Run();
